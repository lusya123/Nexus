# Nexus - Agent Arena Monitor Progress Log

## Project Overview
Local web dashboard that auto-discovers and displays real-time Claude Code / Codex / OpenClaw sessions.
Phase 1: Claude Code only.

## Architecture
- server.js: Node.js backend (HTTP + WebSocket + file watching + process scanning)
- public/index.html: Single-file frontend (HTML + CSS + JS inline)
- Dependency: ws (WebSocket library only)

## Progress

### Session 1 - Full Phase 1 Implementation
- Created feature_list.json with 12 Phase 1 features
- Created claude-progress.txt (this file)
- Created init.sh startup script
- Implemented server.js with:
  - HTTP server serving public/index.html
  - WebSocket server for real-time push
  - File discovery scanning ~/.claude/projects, ~/.codex/sessions, ~/.openclaw/agents
  - fs.watch for real-time file change detection
  - Incremental JSONL reading (byte offset tracking)
  - 3 parsers: Claude Code (nested message format), Codex, OpenClaw (nested message format)
  - Process scanning via pgrep + lsof (claude process name is 'node', not 'claude')
  - Session state machine: ACTIVE → IDLE → COOLING → GONE
  - Dynamic cooldown based on session duration
- Implemented public/index.html with:
  - Dark theme grid layout
  - Session cards with tool badges, names, timestamps
  - Real-time message rendering with auto-scroll
  - Staggered entry queue (150ms between cards)
  - Elastic bounce entry animation
  - Breathing pulse for ACTIVE cards
  - Fade-out exit for COOLING cards
  - WebSocket auto-reconnect
- Key findings:
  - Claude Code JSONL format: { type: "user", message: { role, content } } (not direct { role, content })
  - OpenClaw JSONL format: { type: "message", message: { role, content } }
  - Claude process name in ps is 'claude' but lsof -c claude fails (process is actually 'node')
  - Fixed: use pgrep -f "^claude" then lsof -p <pids>
  - CWD encoding: /Users/xxx → -Users-xxx (leading dash preserved)
- Tested: 3 sessions discovered (2 Claude Code + 1 OpenClaw), messages parsed correctly
